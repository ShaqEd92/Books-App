@{
ViewData["Title"] = "Books";
}

<partial name="NavbarPartial"></partial>

<div class="mx-auto" id="dashboard" style="width: 95%;">
    @foreach(var book in @ViewBag.AllBooks)
    {
        bool bookRead = false;
        bool onReadList = false;
        bool faved = false;

        @if(@ViewBag.ReaderInSession.ReadingList != null)
        {
            @foreach(var willRead in @ViewBag.ReaderInSession.ReadingList)
            {
                if(@willRead.BookID == @book.BookID)
                {
                    onReadList = true;
                }
            }        
        }  

        @if(@ViewBag.ReaderInSession.BooksRead != null)
        {
            @foreach(var readAlready in @ViewBag.ReaderInSession.BooksRead)
            {
                if(@readAlready.BookID == @book.BookID)
                {
                    bookRead = true;
                }
            }  
        }

        @if(@ViewBag.ReaderInSession.MyFaves != null)
        {
            @foreach(var liked in @ViewBag.ReaderInSession.MyFaves)
            {
                if(@liked.BookID == @book.BookID)
                {
                    faved = true;
                }
            }  
        }

        <!-- IF BOOK HAS NOT BEEN READ -->

        @if(bookRead == false)
        {
        <div id="bookCard" class="card" style="background-color: white">
            <div class="card-body">
                <h5 class="card-title"> 
                    <a href="DisplayBook/@book.BookID" style="color: black">@book.Title &nbsp;</a>
                    @if(onReadList == true)
                    {
                        <img style="justify-content: right" src="~/list.png" data-toggle="popover" title="On Your Reading List">
                    }                        
                </h5>
                <a href="FilterAuthor/@book.Author">
                    <h6 class="card-subtitle mb-2 text-muted">@book.Author</h6>
                </a>
                <p class="card-text">@book.Description</p>
                <p><a href="FilterGenre/@book.Genre" class="card-link" style="color: rgb(9, 161, 9)">@book.Genre</a></p>
                <p style="display: inline">
        
                    @if(onReadList == false && bookRead == false)
                    {
                    <form action="WillRead/@book.BookID" method="post" style="display: inline">
                        <input type="hidden" name="@book.BookID">
                        <button data-toggle="popover" title="Add to 'Books to Read' List"><img src="~/books.png"></button>
                    </form>
                    }
        
                    @if(bookRead == false)
                    {
                    <form action="DidRead/@book.BookID" method="post" style="display: inline">
                        <input type="hidden" name="@book.BookID">
                        <button data-toggle="popover" title="Mark Book as 'Read'"><img src="~/checked.png"></button>
                        &nbsp;
                    </form>
                    }
        
                    @if(book.ReaderID == ViewBag.ReaderID)
                    {
                    <a href="EditBook/@book.BookID" style="display: inline" data-toggle="popover" title="Edit Book"><img src="~/edit.png"></a>        
                    <form action="Delete/@book.BookID" method="post" style="display: inline">
                        <input type="hidden" name="@book.BookID">
                        &nbsp;
                        <button onclick="deleteButton()" id="deleteBook" data-toggle="popover" title="Delete Book"><img src="~/clear.png"></button>
                    </form>
                    }
                </p>
            </div>
        </div>
        }

        <!-- IF BOOK HAS BEEN READ -->

        @if(bookRead == true)
        {
            <div id="bookCard" class="card" style="background-color: rgb(197, 248, 197)">
                <div class="card-body">
                    <h5 class="card-title"> 
                        <a href="DisplayBook/@book.BookID" style="color: black">@book.Title</a> 
                        @if(faved == true)
                        {
                            <span style="justify-content: right; font-size: 0.75em" data-toggle="popover" title="A Favorite">&nbsp; &#128151;</span>
                        }   
                    </h5>
                    <a href="FilterAuthor/@book.Author">
                        <h6 class="card-subtitle mb-2 text-muted">@book.Author</h6>
                    </a>
                    <p class="card-text">@book.Description</p>
                    <p><a href="FilterGenre/@book.Genre" class="card-link" style="color: rgb(9, 161, 9)">@book.Genre</a></p>
                    <p style="display: inline">

                        @if(faved == false)
                        {
                        <form action="AddToFaves/@book.BookID" method="post" style="display: inline">
                            <input type="hidden" name="@book.BookID">
                            <button data-toggle="popover" title="Add as Favorite" style="padding: 0">&#128154; &nbsp;</button>
                        </form>
                        }
            
                        @if(book.ReaderID == ViewBag.ReaderID)
                        {
                        <a href="EditBook/@book.BookID" style="display: inline" data-toggle="popover" title="Edit Book"><img
                                src="~/edit.png"></a>
                        
                        <form action="Delete/@book.BookID" method="post" style="display: inline">
                            <input type="hidden" name="@book.BookID">
                            &nbsp;
                            <button onclick="deleteButton(Check)" id="deleteBook" data-toggle="popover" title="Delete Book"><img
                                    src="~/clear.png"></button>
                        </form>
                        }
                    </p>
                </div>
            </div>
        }
    }    
</div>
    

<script type="text/javascript">

    $(document).ready(function () {
        $('[data-toggle="popover"]').popover();
    });

    function deleteButton(Check) {
        var x = confirm("Are you sure you want to delete this book?");
        if (x == false) {
            Check = "No";
            return Check;
        }
    };

</script>


<!-- <div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a
        href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>

<div>Icons made by <a href="https://www.flaticon.com/authors/maxim-basinski" title="Maxim Basinski">Maxim Basinski</a>
    from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>

<div>Icons made by <a href="https://www.flaticon.com/authors/smashicons" title="Smashicons">Smashicons</a> from <a
        href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>

<div>Icons made by <a href="https://www.flaticon.com/authors/pixelmeetup" title="Pixelmeetup">Pixelmeetup</a> from <a
        href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->

<!-- <div>Icons made by <a href="https://www.flaticon.com/authors/smashicons" title="Smashicons">Smashicons</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->